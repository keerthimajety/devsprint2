<?xml version="1.0" encoding="UTF-8"?>
<ApprovalProcess xmlns="http://soap.sforce.com/2006/04/metadata">
    <active>true</active>
    <allowRecall>false</allowRecall>
    <allowedSubmitters>
        <type>owner</type>
    </allowedSubmitters>
    <approvalPageFields>
        <field>Name</field>
        <field>Owner</field>
        <field>Annual_Revenue__c</field>
        <field>Do_You_Have_Registration_Firm__c</field>
        <field>No_of_Employees__c</field>
        <field>Year_of_Establishment__c</field>
    </approvalPageFields>
    <approvalStep>
        <allowDelegate>false</allowDelegate>
        <assignedApprover>
            <approver>
                <type>userHierarchyField</type>
            </approver>
        </assignedApprover>
        <entryCriteria>
            <criteriaItems>
                <field>Dealer__c.Do_You_Have_Registration_Firm__c</field>
                <operation>equals</operation>
                <value>True</value>
            </criteriaItems>
            <criteriaItems>
                <field>Dealer__c.Do_You_Have_Warehouse__c</field>
                <operation>equals</operation>
                <value>True</value>
            </criteriaItems>
            <criteriaItems>
                <field>Dealer__c.No_of_Employees__c</field>
                <operation>greaterThan</operation>
                <value>5</value>
            </criteriaItems>
        </entryCriteria>
        <ifCriteriaNotMet>RejectRecord</ifCriteriaNotMet>
        <label>step1</label>
        <name>step1</name>
    </approvalStep>
    <description>Once the dealer is registered the record is submitted for dealer manager to approve/reject based on the sm seals business criteria requirement.IF the dealer manager approves the record status is approved.
If the dealer rejected ,the status changes to rejected and send email to the dealer  that the application is rejected.</description>
    <emailTemplate>unfiled$public/Dealer_manager_email</emailTemplate>
    <enableMobileDeviceAccess>false</enableMobileDeviceAccess>
    <entryCriteria>
        <criteriaItems>
            <field>Dealer__c.Status__c</field>
            <operation>equals</operation>
            <value>New</value>
        </criteriaItems>
    </entryCriteria>
    <finalApprovalActions>
        <action>
            <name>Alert_for_the_physical_verification_team_new_dealer_application_assigned</name>
            <type>Alert</type>
        </action>
        <action>
            <name>change_owner_to_queue</name>
            <type>FieldUpdate</type>
        </action>
        <action>
            <name>update_status_field</name>
            <type>FieldUpdate</type>
        </action>
    </finalApprovalActions>
    <finalApprovalRecordLock>false</finalApprovalRecordLock>
    <finalRejectionActions>
        <action>
            <name>Send_email_to_dealer_on_rejection</name>
            <type>Alert</type>
        </action>
        <action>
            <name>update_status_field_on_rejection</name>
            <type>FieldUpdate</type>
        </action>
    </finalRejectionActions>
    <finalRejectionRecordLock>false</finalRejectionRecordLock>
   
    <label>Dealer registration approval</label>
    <nextAutomatedApprover>
        <useApproverFieldOfRecordOwner>false</useApproverFieldOfRecordOwner>
        <userHierarchyField>Manager</userHierarchyField>
    </nextAutomatedApprover>
    <processOrder>1</processOrder>
    <recordEditability>AdminOnly</recordEditability>
    <showApprovalHistory>true</showApprovalHistory>
</ApprovalProcess>
